@echo off
:: é˜²æ­¢é—ªé€€çš„å…³é”®è®¾ç½®
setlocal enabledelayedexpansion

:: è®¾ç½®çª—å£æ ‡é¢˜å’Œé¢œè‰²
title æƒ…ç»ªç”»å¸ƒ - ä¸€é”®å¯åŠ¨
color 0A

:: æ˜¾ç¤ºå¯åŠ¨ä¿¡æ¯
echo â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
echo â•‘        æƒ…ç»ªç”»å¸ƒ - ä¸€é”®å¯åŠ¨             â•‘
echo â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
echo æ­£åœ¨æ£€æŸ¥çŽ¯å¢ƒ...

:: æ£€æŸ¥Node.js
node --version >nul 2>&1
if errorlevel 1 (
    echo âŒ Node.jsæœªå®‰è£…ï¼
    echo.
    echo è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š
    echo 1. è®¿é—® https://nodejs.org/
    echo 2. ä¸‹è½½å¹¶å®‰è£…Node.js
    echo 3. å®‰è£…å®ŒæˆåŽé‡æ–°è¿è¡Œæ­¤è„šæœ¬
    echo.
    echo æŒ‰ä»»æ„é”®é€€å‡º...
    pause >nul
    exit /b 1
)

echo âœ… Node.jså·²å®‰è£…

:: è¿›å…¥é¡¹ç›®ç›®å½•
cd /d "%~dp0"

:: æ£€æŸ¥ä¾èµ–
if not exist "node_modules" (
    echo æ­£åœ¨å®‰è£…ä¾èµ–...
    call npm install
    if errorlevel 1 (
        echo âŒ ä¾èµ–å®‰è£…å¤±è´¥ï¼
        echo è¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥åŽé‡è¯•
        pause
        exit /b 1
    )
)

echo âœ… ä¾èµ–å·²å°±ç»ª

:: æ£€æŸ¥ç«¯å£å ç”¨
echo æ­£åœ¨æ£€æŸ¥ç«¯å£...
netstat -ano | findstr ":3000" >nul
if %errorlevel%==0 (
    echo âš ï¸ ç«¯å£3000å·²è¢«å ç”¨ï¼Œå°†ä½¿ç”¨å…¶ä»–ç«¯å£
)

:: å¯åŠ¨åŽç«¯æœåŠ¡
echo.
echo æ­£åœ¨å¯åŠ¨åŽç«¯æœåŠ¡å™¨...
start cmd /k "title åŽç«¯æœåŠ¡å™¨ && cd /d "%~dp0" && npm run server"
timeout /t 3 >nul

:: å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨
echo æ­£åœ¨å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨...
start cmd /k "title å‰ç«¯å¼€å‘æœåŠ¡å™¨ && cd /d "%~dp0" && npm run dev"

:: ç­‰å¾…æœåŠ¡å¯åŠ¨
timeout /t 2 >nul

:: æ‰“å¼€æµè§ˆå™¨
echo.
echo ðŸŽ‰ å¯åŠ¨æˆåŠŸï¼
echo æ­£åœ¨æ‰“å¼€æµè§ˆå™¨...
timeout /t 1 >nul
start http://localhost:5173
start http://localhost:3000/api/health

echo.
echo â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
echo â•‘           å¯åŠ¨å®Œæˆï¼                  â•‘
echo â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
echo â•‘  å‰ç«¯åœ°å€ï¼šhttp://localhost:5173      â•‘
echo â•‘  åŽç«¯åœ°å€ï¼šhttp://localhost:3000      â•‘
echo â•‘  APIæµ‹è¯•ï¼šhttp://localhost:3000/api/health â•‘
echo â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
echo æŒ‰ä»»æ„é”®å…³é—­æ­¤çª—å£ï¼ˆä¸ä¼šå½±å“å·²å¯åŠ¨çš„æœåŠ¡ï¼‰...
pause >nul